<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title></title>
    <style>
        body {
            display: grid;
            width: 20%;
        }
        
        h1 {
            font-size: 16pt;
        }
        
        h2 {
            font-size: 14pt;
            padding-top: 5%;
        }
        
        form {
            display: grid;
        }
        
        label {
            margin-top: 15px;
        }
    </style>
</head>

<body>


    <h1>ArtNet Node</h1>


    <form id="inputForm">
        <h2>Device settings</h2>
        <label for="shortName">Short name</label><br>
        <input type="text" id="shortName" name="shortName" value="@shortName@" maxlength="18"><br>

        <label for="longName">Long name</label><br>
        <input type="text" id="longName" name="longName" value="@longName@" maxlength="64"><br>

        <label for="ipAddress">IP address</label><br>
        <input type="text" id="ipAddress" name="ipAddress" value="@ipAddress@"><br>

        <label for="subnetMask ">Subnet mask</label><br>
        <input type="text" id="subnetMask" name="subnetMask" value="@subnetMask@"><br>

        <h2>Port settings</h2>
        <label for="net">Net</label><br>
        <input type="text" id="net" name="net" value="@net@"><br>

        <label for="primary">Subnet</label><br>
        <input type="text" id="subnet" name="subnet" value="@subnet@"><br>

        <label for="primary">Universe 1</label><br>
        <input type="text" id="uni1" name="uni1" value="@uni1@"><br>

        <label for="primary">Universe 2</label><br>
        <input type="text" id="uni2" name="uni2" value="@uni2@"><br>

        <input type="submit" name="submit" value="Submit"><br>
    </form>
    <script>
        const formToJSON = (elements) => [].reduce.call(
            elements,
            (data, element) => {
                data[element.name] = element.value;
                return data;
            }, {}
        );

        const postRequest = (data) => {
            var xhr = new XMLHttpRequest();
            var url = "data.json";
            xhr.open("POST", url, true);
            xhr.setRequestHeader("Content-Type", "application/json");
            xhr.onload = () => {
                if (xhr.readyState === 4 && xhr.status === 201) {
                    var json = JSON.parse(xhr.responseText);
                    console.log(json.email + ", " + json.password);
                }
            };

            xhr.send(data);
        }

        const isIpAddress = (ip) => {
            if (/^(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/.test(ip)) {
                return (true)
            }

            return (false)
        }




        const handleFormSubmit = (event) => {
            event.preventDefault();

            if (!isIpAddress(form.elements["ipAddress"].value)) {
                alert("You have entered an invalid IP address!");
                return -1;
            }

            if (!isIpAddress(form.elements["subnetMask"].value)) {
                alert("You have entered an invalid Subnet Mask!");
                return -1;
            }


            const data = formToJSON(form.elements);
            postRequest(JSON.stringify(data, null, " "));
        };

        const form = document.getElementById("inputForm");
        form.addEventListener("submit", handleFormSubmit);
    </script>
</body>

</html>
